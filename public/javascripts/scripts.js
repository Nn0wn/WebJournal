$(()=>{$("#user-status").on("change",()=>{const e=$("#user-status").val();"Студент"===e?($(".student-form").css("display","block"),$(".lecturer-form").css("display","none")):"Преподаватель"===e?($(".student-form").css("display","none"),$(".lecturer-form").css("display","block")):($(".student-form").css("display","none"),$(".lecturer-form").css("display","none"))}),$("input").on("focus",()=>{$("p.error").remove(),$("input").removeClass("error"),$("select").removeClass("error")}),$("select").on("change",()=>{$("p.error").remove(),$("input").removeClass("error"),$("select").removeClass("error")}),$(".confirm-button-1").on("click",e=>{e.preventDefault(),$("p.error").remove(),$("input").removeClass("error"),$("select").removeClass("error");let t={};const s={username:"#username",usersurname:"#usersurname",userpatronymic:"#userpatronymic"},r=$("#roots").is(":checked");let o=!0;const a=$("#user-status").val();if(r&&""===a)Object.entries(s).forEach(e=>{""===$(e[1]).val()&&($(e[1]).addClass("error"),o=!1)}),o?t={type:0,name:$("#username").val(),surname:$("#usersurname").val(),patronymic:$("#userpatronymic").val(),isAdmin:r}:$(".create-user h1").after('<p class="error"> Заполните выделенные поля </p>');else if("Студент"===a){const e={...s,fakult:"#fakult",course:"#course",spec:"#spec"};Object.entries(e).forEach(e=>{""===$(e[1]).val()&&($(e[1]).addClass("error"),o=!1)}),o?t={type:1,name:$("#username").val(),surname:$("#usersurname").val(),patronymic:$("#userpatronymic").val(),isAdmin:r,fakult:$("#fakult").val(),spec:$("#spec").val(),course:$("#course").val()}:$(".create-user h1").after('<p class="error"> Необъодимо заполнить все поля </p>')}else if("Преподаватель"===a){const e={...s,department:"#department"};Object.entries(e).forEach(e=>{""===$(e[1]).val()&&($(e[1]).addClass("error"),o=!1)}),o?t={type:2,name:$("#username").val(),surname:$("#usersurname").val(),patronymic:$("#userpatronymic").val(),isAdmin:r,department:$("#department").val()}:$(".create-user h1").after('<p class="error"> Необъодимо заполнить все поля </p>')}else $("#user-status").addClass("error"),$(".create-user h1").after('<p class="error"> Выберите статус </p>');0===Object.keys(t).length&&t.constructor===Object||$.ajax({type:"POST",data:JSON.stringify(t),contentType:"application/json",url:"/administration/newuser"}).done(e=>{console.log(e)})}),$("#fakult").on("change",function(){const e=$(this).val();console.log(e),$.ajax({type:"POST",data:JSON.stringify({val:e}),contentType:"application/json",url:"/administration/get/spec"}).done(e=>{console.log(e);const t=$("#spec");let s=[];s=t.prop?t.prop("options"):t.attr("options"),$("option",t).remove(),s[0]=new Option("Не выбрано","");for(let t=0;t<e.specs.length;t+=1)s[t+1]=new Option(e.specs[t],e.specs[t])})}),$("#group-chose").on("change",function(){const e=$(this).val();console.log(e),$.ajax({type:"POST",data:JSON.stringify({val:e}),contentType:"application/json",url:"/administration/get/group"}).done(e=>{console.log(e);const t=$("#subject-chose");let s=[];s=t.prop?t.prop("options"):t.attr("options"),$("option",t).remove(),s[0]=new Option("Не выбрано","");for(let t=0;t<e.subjects.length;t+=1)s[t+1]=new Option(e.subjects[t].name,e.subjects[t].id)})}),$(".confirm-button-2").on("click",e=>{e.preventDefault(),$("p.error").remove(),$("select").removeClass("error");const t=[];if(""===$("#lecturer-chose").val()&&t.push("lecturer-chose"),""===$("#group-chose").val()&&t.push("group-chose"),""===$("#subject-chose").val()&&t.push("subject-chose"),Array.isArray(t)&&t.length>0){$(".add-lecturer h1").after('<p class="error"> Необходимо выбрать все селекторы </p>');for(let e=0;e<t.length;e+=1)$(`#${t[e]}`).addClass("error")}else if(Array.isArray(t)&&0===t.length){const e={lecturer:$("#lecturer-chose").val(),group:$("#group-chose").val(),subject:$("#subject-chose").val()};console.log(e),$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/administration/set/group/lecturer"}).done(e=>{console.log(e)})}})}),$(()=>{let e=!0;$(".switch-ref").on("click",t=>{t.preventDefault(),$("p.error").remove(),$("input").removeClass("error"),$("input").val(""),e?(e=!1,$(".register").show("slow"),$(".login").hide("slow")):(e=!0,$(".login").show("slow"),$(".register").hide("slow"))}),$("input").on("focus",()=>{$("p.error").remove(),$("input").removeClass("error")}),$(".login-button").on("click",e=>{e.preventDefault(),$("p.error").remove(),$("input").removeClass("error");const t={email:$("#log-email").val(),password:$("#log-password").val()};$.ajax({type:"POST",data:JSON.stringify(t),contentType:"application/json",url:"/auth/login"}).done(e=>{e.ok?$(window.location).attr("href","/"):($(".login h1").after(`<p class="error">${e.error}</p>`),e.fields&&e.fields.forEach(e=>{$(`input[name=${e}]`).addClass("error")}))})})}),$(()=>{$(".accordion").accordion({collapsible:!0});const e={id:"",subject:"",value:"",comment:""};function t(){$("p.error").remove(),$("input").removeClass("error"),$("select").removeClass("error"),$(".dialog").css("height","181"),$("#mark-select").val(""),$("#comment").val("")}$(document).tooltip({}),$("select").on("change",()=>{$("p.error").remove(),$("input").removeClass("error"),$("select").removeClass("error"),$(".dialog").css("height","181")});const s=$(".dialog").dialog({autoOpen:!1,dialogClass:"dialog-title",height:300,width:350,modal:!0,buttons:{Ok(){var r;e.value=$("#mark-select").val(),e.comment=$("#comment").val(),$("p.error").remove(),$("#mark-select").removeClass("error"),$(".dialog").css("height","181"),(""!==$("#mark-select").val()||($(".dialog").css("height","250"),$("fieldset").before('<p class="error"> Выберите оценку </p>'),$("#mark-select").addClass("error"),0))&&(r=e,$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/marks/update"}).done(t=>{t.ok&&("update"===t.type?($(`.${e.id}`).html(e.value),$(`.${e.id}`).prop("title",`Дата: ${Date(Date.now())}. Комментарии: ${e.comment}`),$(`.${e.id}`).removeClass($(`.${e.id}`).attr("class").split(" ").pop()),$(`.${e.id}`).addClass(`mark${e.value}`)):$(`#new${e.subject}`).before(`<button class="mark- ${t.newId} ${e.subject} mark${e.value}" name=mark-${t.newId} class=mark${e.value} id=${t.newId} title="Дата:${Date(Date.now())}. Комментарии: ${e.comment}">${e.value}</button>`))}),t(),s.dialog("close"))},Delete(){var r;r=e,$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/marks/delete"}).done(e=>{e.ok&&$(`.${r.id}`).remove()}),t(),s.dialog("close")},Cancel(){t(),s.dialog("close")}},close(){t(),s.dialog("close")}});$(document).on("click",'button[name^="mark-"]',function(){const t=$(this).attr("class").split(" ");e.id=t[1],e.subject=t[2],function(e,t){const s=window.location.href.split("/")[window.location.href.split("/").length-1];console.log(s),$.ajax({type:"POST",data:JSON.stringify({page:s}),contentType:"application/json",url:"/marks/get"}).done(s=>{for(let r=0;r<s.data.studentProfile.semesters.length;r+=1)for(let o=0;o<s.data.studentProfile.semesters[r].subjects.length;o+=1)if(s.data.studentProfile.semesters[r].subjects[o]._id===e){for(let e=0;e<s.data.studentProfile.semesters[r].subjects[o].marks.length;e+=1)if(s.data.studentProfile.semesters[r].subjects[o].marks[e]._id===t){$("#mark-select").val(s.data.studentProfile.semesters[r].subjects[o].marks[e].value),$("#comment").val(s.data.studentProfile.semesters[r].subjects[o].marks[e].comments);break}break}})}(t[2],t[1]),s.dialog("open")})}),$(()=>{$("#fakult").on("change",function(){const e=$(this).val();console.log(e),$.ajax({type:"POST",data:JSON.stringify({val:e}),contentType:"application/json",url:"/administration/get/spec"}).done(e=>{console.log(e);const t=$("#spec");let s=[];s=t.prop?t.prop("options"):t.attr("options"),$("option",t).remove(),s[0]=new Option("Не выбрано","");for(let t=0;t<e.specs.length;t+=1)s[t+1]=new Option(e.specs[t],e.specs[t])})}),$(".search-button").on("click",e=>{e.preventDefault();const t={fio:$("#fio").val(),fakult:$("#fakult").val(),course:$("#course").val(),spec:$("#spec").val()};console.log(t),$.ajax({type:"POST",data:JSON.stringify(t),contentType:"application/json",url:"/search/students"}).done(e=>{$(".table-body-td").remove(),$("th").css("width","1000px"),$(".table-head-th-0").css("width","8px"),Object.entries(e.data).reverse().forEach(e=>{e[1].studentProfile&&e[1].studentProfile._id&&$(".table-body").after(`<tr class="table-body-td"><th>${parseInt(e[0],10)+parseInt(1,10)}</th><td><a href="/students/${e[1]._id}">${`${e[1].surname} ${e[1].name} ${e[1].patronymic}`}</a></td><td>${e[1].studentProfile.fakult}</td><td>${e[1].studentProfile.course}</td><td>${e[1].studentProfile.spec}</td></tr>`)})})})});